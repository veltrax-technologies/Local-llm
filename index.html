<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Veltrax GPU Capacity · Queue · Hardware Configurator</title>
<style>
  /* ─────────────────────────────────────────────
     Veltrax dark palette
     ───────────────────────────────────────────── */
  :root{
    --bg:#0F1220;           /* background */
    --text:#E6E7EB;         /* primary text */
    --muted:#A9B1C3;        /* secondary text */
    --panel:#121832;        /* card background */
    --border:#22304F;       /* borders */
    --accent:#6F42C1;       /* purple */
    --primary:#0066FF;      /* action blue */
    --good:#20C997;         /* green badge */
    --warn:#FFB454;         /* yellow badge */
    --bad:#FF6B6B;          /* red badge */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:15px/1.6 system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif}
  h1{margin:0 0 8px 0;font-size:24px}
  p{margin:6px 0}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}

  /* Layout */
  .grid{display:grid;grid-template-columns:1fr;gap:16px}
  @media (min-width:1024px){ .grid{grid-template-columns:1fr 1fr} }

  .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px}
  .subtle{color:var(--muted)}

  /* Inputs */
  .field{display:grid;gap:6px;margin-bottom:12px}
  label{font-weight:700}
  input[type="number"]{appearance:textfield}
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button{appearance:none;margin:0}
  .input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#0F1530;color:var(--text)}
  .input:focus{outline:2px solid var(--primary);outline-offset:2px}
  .helper{color:#ff8080;font-size:12px;min-height:14px}

  .btn{border:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,0));padding:10px 14px;border-radius:10px;color:var(--text);cursor:pointer;font-weight:700}
  .btn.primary{background:linear-gradient(180deg,rgba(0,102,255,.25),rgba(0,102,255,.08));border-color:#1d4ed8}
  .btn:hover{filter:brightness(1.05)}

  /* Results */
  .results{display:grid;grid-template-columns:1fr;gap:12px}
  @media (min-width:700px){ .results{grid-template-columns:repeat(2,1fr)} }
  @media (min-width:1024px){ .results{grid-template-columns:repeat(3,1fr)} }

  .metric{background:#0F1633;border:1px solid var(--border);border-radius:12px;padding:14px;display:flex;flex-direction:column;gap:6px}
  .metric h3{margin:0 0 2px 0;font-size:14px;font-weight:700;color:#C9D2E6}
  .value{font-size:26px;font-weight:800;letter-spacing:.3px}
  .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}

  .badge{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:5px 10px;border-radius:999px;font-size:12px;font-weight:800;border:1px solid rgba(255,255,255,.15)}
  .green{background:rgba(32,201,151,.18);color:#9CF0D5;border-color:rgba(32,201,151,.45)}
  .yellow{background:rgba(255,180,84,.2);color:#FFE1AF;border-color:rgba(255,180,84,.45)}
  .red{background:rgba(255,107,107,.2);color:#FFC2C2;border-color:rgba(255,107,107,.45)}

  /* Tooltip "i" */
  .info{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:50%;background:rgba(255,255,255,.08);border:1px solid var(--border);font-weight:900;font-size:12px;color:#D7DBE6;position:relative}
  .info[data-tip]:hover::after{content:attr(data-tip);position:absolute;left:50%;transform:translateX(-50%);bottom:130%;width:max-content;max-width:260px;background:#0b1226;color:#dfe8ff;border:1px solid #1f2b44;padding:8px 10px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.35)}

  .founders{margin-top:16px;border:2px solid var(--accent);background:linear-gradient(180deg,rgba(111,66,193,.12),rgba(111,66,193,.03));border-radius:14px;padding:14px}
  .teaser{margin:16px 0;border:1px dashed var(--border);border-radius:12px;padding:12px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;background:rgba(255,255,255,.03)}
  footer{margin-top:14px;color:var(--muted)}
</style>
</head>
<body>
  <main class="wrap">
    <section class="card" aria-label="Intro">
      <h1>Veltrax GPU Capacity · Queue · Hardware Configurator</h1>
      <p class="subtle">Plan GPUs for chat assistants (VIA) and fraud/loan inference. Runs 100% in the browser — no backend. Change inputs, hit <em>Calculate</em>, and see capacity, utilization, queue estimates, and a recommended hardware tier.</p>
    </section>

    <section class="grid" aria-label="Inputs and Results">
      <div class="card" aria-label="Inputs">
        <h2 style="margin:0 0 10px 0">Inputs</h2>
        <div class="field">
          <label for="ccu">Concurrent Chatbot Users</label>
          <input id="ccu" class="input" type="number" inputmode="numeric" min="0" step="1" value="120" aria-label="Concurrent Chatbot Users"/>
          <div id="ccuHelp" class="helper"></div>
        </div>
        <div class="field">
          <label for="tpc">Average Tokens per Chat</label>
          <input id="tpc" class="input" type="number" inputmode="numeric" min="1" step="1" value="350" aria-label="Average Tokens per Chat"/>
          <div id="tpcHelp" class="helper"></div>
        </div>
        <div class="field">
          <label for="ftph">Fraud/Loan Transactions per Hour</label>
          <input id="ftph" class="input" type="number" inputmode="numeric" min="0" step="1" value="15000" aria-label="Fraud or Loan Transactions per Hour"/>
          <div id="ftphHelp" class="helper"></div>
        </div>
        <button id="calc" class="btn primary" aria-label="Calculate capacity">Calculate Capacity</button>
      </div>

      <div class="card" aria-label="Outputs">
        <h2 style="margin:0 0 10px 0">Outputs</h2>
        <div class="results">
          <div class="metric" aria-live="polite">
            <h3>Chatbot GPUs Required</h3>
            <div class="row"><div id="gpuChat" class="value">–</div><span id="utilChatBadge" class="badge">–</span></div>
          </div>
          <div class="metric" aria-live="polite">
            <h3>Fraud/Loan GPUs Required</h3>
            <div class="row"><div id="gpuFraud" class="value">–</div><span id="utilFraudBadge" class="badge">–</span></div>
          </div>
          <div class="metric">
            <h3>Total GPUs Required</h3>
            <div id="gpuTotal" class="value">–</div>
          </div>
          <div class="metric">
            <h3>Estimated Chatbot Queue (minutes) <span class="info" data-tip="Queue times are conservative estimates using a deterministic service model; real systems may batch and preempt to reduce delays.">i</span></h3>
            <div id="queueChat" class="value">0</div>
          </div>
          <div class="metric">
            <h3>Estimated Fraud/Loan Queue (minutes) <span class="info" data-tip="Deterministic estimate based on soft utilization limit and per‑GPU hourly throughput.">i</span></h3>
            <div id="queueFraud" class="value">0</div>
          </div>
          <div class="metric">
            <h3>Rates</h3>
            <div class="subtle" id="ratesText">–</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Recommended build card -->
    <section class="card" aria-label="Recommended Build">
      <h2 style="margin:0 0 10px 0">Recommended Build</h2>
      <div class="results">
        <div class="metric"><h3>Tier</h3><div id="recTier" class="value">–</div></div>
        <div class="metric"><h3>Suggested GPUs</h3><div id="recGpus" class="value">–</div></div>
        <div class="metric"><h3>Est. Hardware Cost</h3><div id="recCost" class="value">–</div></div>
      </div>
      <div class="metric" style="margin-top:12px"><h3>Why this build</h3><div id="recWhy" class="subtle">We size by concurrency, throughput, and utilization soft limits.</div></div>
    </section>

    <div class="founders" role="note" aria-label="Founders deal">
      <strong>Founders deal:</strong> 30% upfront with milestone deliveries. First 5 get <strong>15% off</strong> + <strong>1 year support</strong>.
    </div>
    <div class="teaser" role="region" aria-label="Next step">
      <div><strong>Next:</strong> Security & Compliance Map — see threats mapped to controls and evidence.</div>
      <a class="btn" href="https://veltrax-technologies.github.io/Security-Compliance/">Open Security Map</a>
    </div>

    <footer>
      <small>© Veltrax — on‑prem, local‑first AI. This configurator is intentionally simple for fast sizing; production deployments include batching, request shaping, and backpressure.</small>
    </footer>
  </main>

<script>
  // ───────────────────────────────────────────────────────────
  // Constants — edit these to tune estimates
  // ───────────────────────────────────────────────────────────
  const CHAT_SESSIONS_PER_GPU = 180;           // conservative concurrency ceiling per chatbot GPU
  const CHAT_TOKENS_PER_SEC_PER_GPU = 150;     // Mistral 7B Q4 on 96GB class GPU
  const FRAUD_TX_PER_HOUR_PER_GPU = 25000;     // Mixtral 8x7B Q4 batch inference

  // Queue thresholds (when to start queueing instead of adding GPUs)
  const CHAT_UTIL_SOFT_LIMIT = 0.80;           // if >80% of session cap, start estimating queue time
  const FRAUD_UTIL_SOFT_LIMIT = 0.85;

  // ───────────────────────────────────────────────────────────
  // Utility
  // ───────────────────────────────────────────────────────────
  const $ = (id)=>document.getElementById(id);
  const pct = (x)=> (Math.round(x*100));
  function badge(el, util){
    let cls='green', label=`${pct(util)}% util`;
    if(util>0.85) cls='red'; else if(util>0.70) cls='yellow';
    el.className = `badge ${cls}`;
    el.textContent = label;
  }
  function parseIntSafe(el, helpEl){
    const v = Number(el.value);
    if(!Number.isFinite(v) || v<0 || !Number.isInteger(v)){
      helpEl.textContent = 'Enter a non‑negative whole number.';
      el.setAttribute('aria-invalid','true');
      return null;
    }
    helpEl.textContent = '';
    el.removeAttribute('aria-invalid');
    return v;
  }

  // ───────────────────────────────────────────────────────────
  // Recommendation logic (tiers & costs)
  // ───────────────────────────────────────────────────────────
  function recommendTier(chatGpus, fraudGpus, chatUsers, fraudHour){
    const total = chatGpus + fraudGpus;
    if(total <= 2 && chatUsers <= 500 && fraudHour <= 75000){
      return { tier:'Tier 1 — Demo/Small', gpus:'2× RTX 4090 (24GB) — or — 1× RTX 6000 Ada (48GB) + 1× 4090', cost:'$7k–$12k', why:'Low concurrency and moderate fraud throughput; dual consumer cards or a single 48GB pro card is sufficient.' };
    }
    if(total <= 2 && chatUsers <= 1200 && fraudHour <= 250000){
      return { tier:'Tier 2 — Mid‑Size', gpus:'2× RTX 6000 Ada (48GB)', cost:'$18k–$26k', why:'Higher concurrency and larger batches. 48GB VRAM per GPU gives headroom for bigger contexts and MoE.' };
    }
    if(total <= 4 && chatUsers <= 3000 && fraudHour <= 1000000){
      return { tier:'Tier 3 — Enterprise', gpus:'2× A100 80GB — or — 2× H100 80GB', cost:'$60k–$90k', why:'Large staff and very high transaction rates. 80GB VRAM enables large dense models with minimal quantization.' };
    }
    return { tier:'Tier 4 — Flagship', gpus:'DGX H100 (8× H100, NVLink)', cost:'$400k+', why:'Nationwide scale or multi‑tenant hub. Multiple models and fine‑tuning in parallel with headroom.' };
  }

  // ───────────────────────────────────────────────────────────
  // Core math — single calculate()
  // ───────────────────────────────────────────────────────────
  function calculate(){
    const ccu = parseIntSafe($('ccu'), $('ccuHelp'));
    const tpc = parseIntSafe($('tpc'), $('tpcHelp'));
    const ftph = parseIntSafe($('ftph'), $('ftphHelp'));
    if(ccu===null || tpc===null || ftph===null) return;

    // A) Chatbot sizing
    const GPUs_chat = (ccu===0)? 0 : Math.ceil(ccu / CHAT_SESSIONS_PER_GPU);
    const chat_seconds_per_session = (tpc<=0) ? 0 : (tpc / CHAT_TOKENS_PER_SEC_PER_GPU);
    const service_rate_per_gpu = (chat_seconds_per_session===0) ? Infinity : (60 / chat_seconds_per_session); // chats/min/GPU
    const service_rate_total = (GPUs_chat===0) ? 0 : GPUs_chat * service_rate_per_gpu; // chats/min

    const session_cap_total = GPUs_chat * CHAT_SESSIONS_PER_GPU;
    const util_sessions = (session_cap_total===0)? 0 : (ccu / session_cap_total);

    let wait_minutes_chat = 0;
    if(GPUs_chat>0 && util_sessions>CHAT_UTIL_SOFT_LIMIT && Number.isFinite(service_rate_total) && service_rate_total>0){
      const excess = ccu - (session_cap_total * CHAT_UTIL_SOFT_LIMIT);
      wait_minutes_chat = Math.max(0, excess / service_rate_total);
    }

    // B) Fraud/Loan sizing
    const GPUs_fraud = (ftph===0)? 0 : Math.ceil(ftph / FRAUD_TX_PER_HOUR_PER_GPU);
    const fraud_cap_total = GPUs_fraud * FRAUD_TX_PER_HOUR_PER_GPU; // tx/hour
    const util_fraud = (fraud_cap_total===0)? 0 : (ftph / fraud_cap_total);

    let wait_minutes_fraud = 0;
    if(GPUs_fraud>0 && util_fraud>FRAUD_UTIL_SOFT_LIMIT){
      const excess_tx = ftph - (fraud_cap_total * FRAUD_UTIL_SOFT_LIMIT);
      wait_minutes_fraud = Math.max(0, 60 * (excess_tx / fraud_cap_total));
    }

    // Populate UI (capacity + queues)
    $('gpuChat').textContent = GPUs_chat.toString();
    $('gpuFraud').textContent = GPUs_fraud.toString();
    $('gpuTotal').textContent = (GPUs_chat + GPUs_fraud).toString();

    $('queueChat').textContent = (Math.round(wait_minutes_chat*10)/10).toFixed(1);
    $('queueFraud').textContent = (Math.round(wait_minutes_fraud*10)/10).toFixed(1);

    badge($('utilChatBadge'), util_sessions);
    badge($('utilFraudBadge'), util_fraud);

    const rateTxt = (Number.isFinite(service_rate_per_gpu))
      ? `Chat service rate ≈ ${service_rate_per_gpu.toFixed(1)} chats/min/GPU (tokens=${tpc}), total ≈ ${(Number.isFinite(service_rate_total)?service_rate_total.toFixed(1):'∞')} chats/min.`
      : `Chat service rate ≈ ∞ (0 tokens).`;
    $('ratesText').textContent = `${rateTxt} Fraud throughput ≈ ${FRAUD_TX_PER_HOUR_PER_GPU} tx/hour/GPU.`;

    // Recommendation
    const rec = recommendTier(GPUs_chat, GPUs_fraud, ccu, ftph);
    $('recTier').textContent = rec.tier;
    $('recGpus').textContent = rec.gpus;
    $('recCost').textContent = rec.cost;
    $('recWhy').textContent = rec.why;
  }

  $('calc').addEventListener('click', calculate);
</script>
</body>
</html>
